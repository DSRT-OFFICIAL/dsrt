<!DOCTYPE html>
<html>
<head>
  <title>Touch Cube Game</title>
  <style>
    body { margin: 0; overflow: hidden; background: #111; color: white; font-family: sans-serif; }
    #score { position: absolute; top: 10px; left: 10px; font-size: 20px; }
    #gameover { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 40px; display: none; }
  </style>
</head>
<body>
  <div id="score">Score: 0</div>
  <div id="gameover">Game Over</div>

  <script type="module">
    import { Scene } from './src/scenes/Scene.js';
    import { PerspectiveCamera } from './src/cameras/PerspectiveCamera.js';
    import { WebGLRenderer } from './src/renderers/WebGLRenderer.js';
    import { BoxGeometry } from './src/geometries/BoxGeometry.js';
    import { MeshBasicMaterial } from './src/materials/MeshBasicMaterial.js';
    import { Mesh } from './src/objects/Mesh.js';
    import { InputManager } from './src/core/InputManager.js';

    const scene = new Scene();
    const camera = new PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.z = 10;

    const renderer = new WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Player
    const playerGeo = new BoxGeometry(1, 1, 1);
    const playerMat = new MeshBasicMaterial({ color: 0x00ff00 });
    const player = new Mesh(playerGeo, playerMat);
    player.position.y = -4;
    scene.add(player);

    // Enemy list
    const enemies = [];

    // Input
    const input = new InputManager();

    // Score
    let score = 0;
    let gameOver = false;
    const scoreEl = document.getElementById('score');
    const gameOverEl = document.getElementById('gameover');

    // Spawn enemy
    function spawnEnemy() {
      const geo = new BoxGeometry(1, 1, 1);
      const mat = new MeshBasicMaterial({ color: 0xff0000 });
      const enemy = new Mesh(geo, mat);
      enemy.position.x = (Math.random() * 10) - 5;
      enemy.position.y = 6;
      scene.add(enemy);
      enemies.push(enemy);
    }

    // Collision check
    function checkCollision(a, b) {
      return (
        Math.abs(a.position.x - b.position.x) < 1 &&
        Math.abs(a.position.y - b.position.y) < 1
      );
    }

    // Game Loop
    function animate() {
      if (gameOver) return;

      requestAnimationFrame(animate);

      // Player movement with touch
      const touches = input.getTouches();
      if (touches.length > 0) {
        const normalizedX = (touches[0].x / window.innerWidth) * 10 - 5;
        player.position.x = normalizedX;
      }

      // Enemies update
      enemies.forEach((enemy, i) => {
        enemy.position.y -= 0.05;
        if (checkCollision(player, enemy)) {
          gameOver = true;
          gameOverEl.style.display = 'block';
        }
      });

      // Remove enemies that go out of screen
      for (let i = enemies.length - 1; i >= 0; i--) {
        if (enemies[i].position.y < -6) {
          scene.remove(enemies[i]);
          enemies.splice(i, 1);
        }
      }

      // Update score
      score += 1;
      scoreEl.textContent = "Score: " + score;

      // Render
      renderer.render(scene, camera);
    }

    // Spawn enemy setiap 2 detik
    setInterval(() => {
      if (!gameOver) spawnEnemy();
    }, 2000);

    animate();
  </script>
</body>
</html>
